# Demonstrate how to use Hermes VFD with hdf5_iotest

## Build Hermes
```bash
git clone https://github.com/jya-kmu/hdf5.git
git checkout kimmy/c_wrapper
git checkout 3d7fd686cefa27d72520f5521afa574332ffc306 .
```
build with `HERMES_ENABLE_WRAPPER=ON`

## Build hdf5 with Hermes VFD
```bash
git checkout https://github.com/jya-kmu/hdf5.git
git checkout hermes_vfd
git checkout 30d224cec2ea21c41ce09083f96885ea4785bbdf .
```
build hdf5 with `HDF5_ENABLE_PARALLEL=ON` and `HDF5_ENABLE_HERMES_VFD=ON`

## Build hdf5-iotest
```bash
git checkout https://github.com/jya-kmu/hdf5-iotest.git
git checkout hermes-vfd
git checkout 82667579201fbf615d3ab26eddbb4a2540016b49 .
```
Then copy hermes.conf file to top hdf5-iotest directory, and edit `src/hdf5_iotest.ini`
file to indicate if split metadata and data is needed (`split = 1`) or not (`split = 0`)

The last parameter in `status = H5Pset_fapl_hermes(fapl, false, 1048576)`
sets up the page size (if `split = 0`) or data page size (if `split = 1`). Default is 1MB.
The last parameter in `status = H5Pset_fapl_hermes(fapl_m, false, 4096)`
sets up the page size for metadata (if `split = 1`). User can modify these parameter
for performance test.

## Config with Hermes
The `hermes.conf` file is used for Hermes environment setup. And the example in `4KB_1MB` 
is used for metadata and data split test, while 4KB is the setup for metadata page size
and 1MB is for data page size. User can modify `mount_points` and 
`swap_mount` in the file according to the executing system configuration.

Set up Herems environment variables by
```bash
export HERMES_CONF=/path/to/hermes.conf
```

## Run
Run the test as
```bash
GLOG_minloglevel=2 /path/to/hdf5_iotest /path/to/hdf5_iotest.ini
```

## Run with Darshan
Darshan output can be generated by running the command
```bash
LD_PRELOAD=/path/to/libdarshan.so GLOG_minloglevel=2 /path/to/hdf5_iotest /path/to/hdf5_iotest.ini
```
